agent_domain: pr_review
agent_purpose: PR review specialist for merge readiness assessment and code quality
  validation
agent_title: ONEX Anti-YOLO Method + BFROS Framework
agent_description: PR review specialist for merge readiness assessment and code quality
  validation with intelligence-driven review prioritization, anti-pattern detection, and
  effectiveness scoring
agent_context: development
domain_query: PR review feedback implementation
implementation_query: pull request management automation
match_count: 5
confidence_threshold: 0.6
knowledge_capture_level: comprehensive
capabilities:
  mandatory_functions: true
  template_system: true
  enhanced_patterns: true
  quality_intelligence: true
  intelligence_capabilities:
    - pr_quality_assessment
    - anti_pattern_detection
    - review_effectiveness_scoring
    - architectural_compliance_check
    - performance_impact_analysis
    - security_vulnerability_scan
    - test_coverage_validation
    - review_prioritization
archon_mcp_enabled: true
correlation_tracking: true
parallel_capable: true

# Intelligence-Specific Triggers
intelligence_triggers:
  - "assess pr quality"
  - "check for anti-patterns in pr"
  - "evaluate review effectiveness"
  - "analyze pr architectural impact"
  - "scan pr for security issues"
  - "validate pr test coverage"
  - "prioritize pr review items"
  - "score pr merge readiness"

# Comprehensive Intelligence Integration
intelligence_integration:
  # Phase 1: Pre-Review Intelligence Gathering
  pre_review:
    quality_baseline:
      tool: assess_code_quality
      inputs:
        - pr_diff_content
        - changed_file_paths
        - programming_languages
      outputs:
        - baseline_quality_score
        - identified_anti_patterns
        - compliance_violations
        - improvement_suggestions
      quality_gates:
        minimum_quality_score: 0.6
        max_critical_violations: 0
        max_high_severity_anti_patterns: 2

    architectural_analysis:
      tool: check_architectural_compliance
      inputs:
        - pr_diff_content
        - architecture_type
        - project_patterns
      outputs:
        - compliance_score
        - architecture_violations
        - pattern_deviations
        - refactoring_recommendations
      quality_gates:
        minimum_compliance_score: 0.7
        max_architecture_violations: 3

    performance_assessment:
      tool: identify_optimization_opportunities
      inputs:
        - changed_code_sections
        - performance_critical_paths
      outputs:
        - performance_risks
        - optimization_opportunities
        - regression_likelihood
      quality_gates:
        max_performance_regressions: 0
        max_high_impact_risks: 1

    security_scan:
      tool: assess_code_quality
      inputs:
        - pr_diff_content
        - security_sensitive_files
      outputs:
        - security_vulnerabilities
        - exposure_risks
        - remediation_steps
      quality_gates:
        max_critical_vulnerabilities: 0
        max_high_vulnerabilities: 1

    review_prioritization:
      strategy: intelligence_weighted
      factors:
        - quality_score_delta
        - architectural_impact
        - performance_risk_level
        - security_vulnerability_count
        - test_coverage_change
        - code_complexity_increase
      outputs:
        - priority_score
        - focus_areas
        - recommended_review_order

  # Phase 2: During-Review Intelligence Enhancement
  during_review:
    real_time_analysis:
      anti_pattern_detection:
        tool: get_quality_patterns
        frequency: per_file_reviewed
        inputs:
          - current_file_content
          - pattern_type: "anti_patterns"
        outputs:
          - detected_anti_patterns
          - severity_levels
          - fix_suggestions
        alert_thresholds:
          critical_anti_patterns: 1
          high_severity_anti_patterns: 2

      quality_trend_tracking:
        tool: assess_code_quality
        frequency: continuous
        inputs:
          - reviewed_file_subset
          - cumulative_changes
        outputs:
          - quality_trend_direction
          - improvement_rate
          - degradation_warnings
        alert_thresholds:
          quality_decline_threshold: -0.15
          sustained_decline_files: 3

      compliance_monitoring:
        tool: check_architectural_compliance
        frequency: per_component_reviewed
        inputs:
          - component_changes
          - architecture_boundaries
        outputs:
          - boundary_violations
          - coupling_increases
          - cohesion_changes
        alert_thresholds:
          boundary_violations: 1
          coupling_increase_threshold: 0.2

    contextual_guidance:
      best_practice_suggestions:
        source: get_quality_patterns
        pattern_type: "best_practices"
        trigger: anti_pattern_detected
        context_aware: true

      historical_issue_warnings:
        source: pattern_learning_service
        query: similar_pr_issues
        trigger: pattern_similarity_detected
        similarity_threshold: 0.75

      optimization_recommendations:
        source: identify_optimization_opportunities
        trigger: performance_risk_detected
        include_roi_analysis: true

  # Phase 3: Post-Review Intelligence Capture
  post_review:
    review_effectiveness_scoring:
      tool: assess_code_quality
      inputs:
        - review_comments_coverage
        - issues_identified_vs_total
        - critical_issues_caught
        - false_positive_rate
      outputs:
        - review_effectiveness_score
        - coverage_percentage
        - quality_improvement_delta
        - reviewer_performance_metrics
      quality_gates:
        minimum_effectiveness_score: 0.75
        minimum_coverage_percentage: 0.85
        minimum_critical_issue_detection: 0.95

    pattern_learning:
      capture_review_patterns:
        tool: track_pattern_creation
        inputs:
          - review_type
          - issues_identified
          - resolution_approaches
          - effectiveness_score
          - time_to_complete
        metadata:
          pr_size: "${pr_lines_changed}"
          pr_complexity: "${complexity_score}"
          reviewer_experience: "${reviewer_level}"
          outcome: "${merge_status}"
        outputs:
          - pattern_id
          - learning_confidence

      feedback_loop:
        tool: create_feedback_loop
        inputs:
          - pattern_id
          - review_outcome
          - merge_success
          - post_merge_issues
        outputs:
          - pattern_effectiveness_score
          - adjustment_recommendations
          - training_data_updates

    quality_report_generation:
      tool: get_optimization_report
      inputs:
        - review_session_data
        - time_window_hours: 168  # Last week
      outputs:
        - review_quality_trends
        - effectiveness_metrics
        - improvement_opportunities
        - benchmark_comparisons
      distribution:
        - review_participants
        - project_stakeholders
        - quality_metrics_dashboard

# Quality Gates Configuration
quality_gates:
  pre_review_gates:
    - gate: minimum_quality_baseline
      threshold: 0.6
      blocking: false
      action: flag_for_priority_review

    - gate: critical_security_vulnerabilities
      threshold: 0
      blocking: true
      action: reject_pr_for_security_fix

    - gate: architectural_compliance
      threshold: 0.7
      blocking: false
      action: request_architecture_review

    - gate: test_coverage_regression
      threshold: -0.05  # Max 5% coverage decrease
      blocking: true
      action: request_additional_tests

  during_review_gates:
    - gate: anti_pattern_accumulation
      threshold: 5
      blocking: false
      action: trigger_refactoring_discussion

    - gate: quality_trend_decline
      threshold: -0.15
      blocking: true
      action: pause_review_request_improvements

    - gate: boundary_violation_detected
      threshold: 1
      blocking: true
      action: request_architectural_alignment

  post_review_gates:
    - gate: review_effectiveness
      threshold: 0.75
      blocking: false
      action: log_reviewer_performance_metric

    - gate: critical_issue_detection_rate
      threshold: 0.95
      blocking: false
      action: flag_for_secondary_review

    - gate: merge_readiness_score
      threshold: 0.85
      blocking: true
      action: approve_merge_or_request_changes

# Pattern Learning Configuration
pattern_learning:
  enabled: true

  learning_objectives:
    - objective: improve_review_prioritization
      metric: time_to_identify_critical_issues
      target_improvement: 0.25  # 25% faster
      measurement_window: 30_days

    - objective: reduce_false_positives
      metric: false_positive_rate
      target_improvement: 0.30  # 30% reduction
      measurement_window: 30_days

    - objective: increase_critical_issue_detection
      metric: critical_issue_detection_rate
      target_improvement: 0.10  # 10% increase
      measurement_window: 30_days

    - objective: optimize_review_effectiveness
      metric: review_effectiveness_score
      target_improvement: 0.15  # 15% improvement
      measurement_window: 60_days

  pattern_capture:
    successful_review_patterns:
      - high_effectiveness_score: ">= 0.9"
        capture_attributes:
          - review_approach
          - prioritization_strategy
          - issue_identification_sequence
          - feedback_communication_style

      - critical_issue_caught_early: true
        capture_attributes:
          - detection_signals
          - analysis_methods
          - verification_steps

      - zero_post_merge_issues: true
        capture_attributes:
          - review_checklist_used
          - verification_depth
          - edge_cases_considered

    problematic_review_patterns:
      - effectiveness_score: "< 0.6"
        capture_attributes:
          - missed_issue_types
          - review_coverage_gaps
          - time_pressure_indicators

      - post_merge_issues: "> 0"
        capture_attributes:
          - issue_categories_missed
          - review_blind_spots
          - complexity_underestimation

      - false_positive_rate: "> 0.25"
        capture_attributes:
          - over_flagged_patterns
          - context_misunderstandings
          - tooling_limitations

  feedback_integration:
    sources:
      - post_merge_bug_reports
      - reviewer_retrospectives
      - merge_outcome_analysis
      - production_incident_correlation

    feedback_processing:
      - correlate_with_review_patterns
      - identify_improvement_areas
      - update_detection_heuristics
      - refine_prioritization_algorithms

    continuous_improvement:
      frequency: weekly
      actions:
        - review_pattern_effectiveness
        - adjust_quality_gate_thresholds
        - update_anti_pattern_detection_rules
        - optimize_review_workflows

# Review Effectiveness Metrics
effectiveness_metrics:
  primary_metrics:
    - metric: critical_issue_detection_rate
      calculation: "critical_issues_found / total_critical_issues"
      target: ">= 0.95"
      weight: 0.30

    - metric: review_coverage_percentage
      calculation: "lines_reviewed / total_lines_changed"
      target: ">= 0.85"
      weight: 0.20

    - metric: false_positive_rate
      calculation: "false_positives / total_issues_flagged"
      target: "<= 0.15"
      weight: 0.15

    - metric: time_to_merge_ready
      calculation: "review_completion_time - review_start_time"
      target: "<= 4_hours"
      weight: 0.15

    - metric: post_merge_issue_rate
      calculation: "post_merge_bugs / total_reviews"
      target: "<= 0.05"
      weight: 0.20

  composite_score:
    calculation: "weighted_average(primary_metrics)"
    interpretation:
      excellent: ">= 0.90"
      good: ">= 0.75"
      acceptable: ">= 0.60"
      needs_improvement: "< 0.60"
