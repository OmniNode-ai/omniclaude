[mypy]
# =============================================================================
# MYPY TYPE CHECKING CONFIGURATION - OmniClaude
# =============================================================================
#
# OWNERSHIP & MAINTENANCE:
#   - Owner: Engineering team / code reviewers
#   - Review: Quarterly (or when adding new ignores)
#   - Last Review: 2025-11-26
#   - Next Review: 2026-02-26
#
# APPROVAL REQUIRED FOR CHANGES:
#   - Adding new module ignores: PR review explaining WHY
#   - Adding exclusion patterns: Must document reasoning
#   - Removing ignores: Encouraged (improves type safety)
#
# GOAL: Gradually reduce ignores as type coverage improves.
# =============================================================================

# General settings
python_version = 3.12
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = False
disallow_incomplete_defs = False
check_untyped_defs = True
warn_redundant_casts = True
warn_unused_ignores = True
warn_no_return = True
warn_unreachable = True
strict_optional = True
show_error_codes = True
show_column_numbers = True
pretty = True

# =============================================================================
# EXCLUSION PATTERNS
# =============================================================================
# Focus on core library type safety first. These exclusions are organized by
# category with explicit justification for each group.
#
# CATEGORIES:
#   1. Test files - Many type errors, lower priority than production code
#   2. Templates - Jinja/string templates, not Python code
#   3. Examples - Demo files not shipped in production
#   4. Legacy - Modules scheduled for deprecation or refactoring
#   5. Generated - Code generated by agent system at runtime
#
# NOTE: skills/ directory is NOT excluded - it contains production code that
# should be type-checked. If skills need exclusion, add explicit pattern.
# =============================================================================
exclude = (?x)(
    # --- TEST FILES (lower priority, many dynamic patterns) ---
    ^agents/tests/
    | ^agents/lib/test_[^/]+\.py$
    | ^agents/parallel_execution/test_[^/]+\.py$
    | ^claude_hooks/tests/
    | ^claude_hooks/modified_performance_test\.py$

    # --- TEMPLATES (Jinja/string templates, not type-checkable) ---
    | ^agents/templates/
    | ^agents/parallel_execution/templates/

    # --- EXAMPLES (demo code, not production) ---
    | ^agents/examples/
    | ^agents/lib/example_[^/]+\.py$
    | ^agents/lib/partition_key_policy_example\.py$
    | ^claude_hooks/examples/

    # --- LEGACY (scheduled for deprecation/refactoring) ---
    | ^agents/lib/legacy/
    | ^agents/lib/codegen_workflow\.py$

    # --- PARALLEL EXECUTION (generated at runtime by agent system) ---
    # These files are created dynamically by dispatch_runner and generate_*
    # scripts. They exist only temporarily during parallel agent execution.
    | ^agents/parallel_execution/agent_[^/]+\.py$
    | ^agents/parallel_execution/generate_[^/]+\.py$
    | ^agents/parallel_execution/dispatch_runner\.py$
    | ^agents/parallel_execution/db_connection_pool\.py$

    # --- CLAUDE HOOKS (dynamic config, memory modules) ---
    | ^claude_hooks/config/
    | ^claude_hooks/lib/memory/
    )

# Use explicit package bases to avoid module conflicts
explicit_package_bases = True

# =============================================================================
# External libraries without type stubs
# =============================================================================
# These are third-party packages that don't ship with type annotations or
# py.typed markers. We ignore missing imports to avoid mypy errors.
[mypy-omnibase_core.*]
ignore_missing_imports = True

[mypy-omnibase_spi.*]
ignore_missing_imports = True

[mypy-langgraph.*]
ignore_missing_imports = True

[mypy-langchain.*]
ignore_missing_imports = True

[mypy-langchain_core.*]
ignore_missing_imports = True

[mypy-aiokafka.*]
ignore_missing_imports = True

[mypy-confluent_kafka.*]
ignore_missing_imports = True

[mypy-qdrant_client.*]
ignore_missing_imports = True

[mypy-anthropic.*]
ignore_missing_imports = True

[mypy-google.generativeai.*]
ignore_missing_imports = True

# =============================================================================
# Internal modules with dynamic imports or optional dependencies
# =============================================================================
# RATIONALE: These modules are part of the OmniClaude codebase but are ignored
# for one or more of the following reasons:
#
# 1. DYNAMIC IMPORTS: Modules loaded dynamically at runtime via importlib or
#    __import__. Mypy cannot trace these import chains statically.
#
# 2. OPTIONAL DEPENDENCIES: Modules that depend on optional packages (e.g.,
#    omnibase_core, langgraph) which may not be installed in all environments.
#
# 3. GENERATED CODE: Modules generated by the agent system or code generation
#    workflows that may not exist at static analysis time.
#
# 4. PLUGIN ARCHITECTURE: Agent plugins and extensions that are discovered and
#    loaded at runtime from the ~/.claude/agent-definitions/ registry.
#
# 5. CIRCULAR IMPORT AVOIDANCE: Some modules use late binding to avoid circular
#    imports, which mypy cannot fully resolve.
#
# MAINTENANCE POLICY:
#   - When adding new internal modules here, document WHY in the inline comment
#   - Prefer fixing type issues over adding ignores
#   - Review quarterly: Can any of these be removed?
#   - New additions require PR approval with justification
#
# ALTERNATIVES TO CONSIDER BEFORE ADDING IGNORES:
#   - Add type stubs (.pyi files) for the module
#   - Use TYPE_CHECKING imports for circular import issues
#   - Make the dependency non-optional if widely used
#   - Refactor dynamic imports to static where feasible
# =============================================================================
#
# Per-module justifications are provided inline below. Each module requires
# ignore_missing_imports for a specific documented reason.
# =============================================================================

# MCP (Model Context Protocol) client - third-party MCP SDK without type stubs
[mypy-mcp_client.*]
ignore_missing_imports = True

# lib.resilience - claude_hooks internal module with bare imports resolved at runtime
# The claude_hooks package modifies sys.path to enable bare imports like `from lib.resilience`
[mypy-lib.resilience]
ignore_missing_imports = True

# -----------------------------------------------------------------------------
# DYNAMIC IMPORT MODULES: Loaded via importlib at runtime, not static imports
# These use bare imports (e.g., `import import_utils`) discovered dynamically.
# -----------------------------------------------------------------------------

# Dynamic module loader - uses importlib to discover modules at runtime
[mypy-import_utils]
ignore_missing_imports = True

# Configuration validation - loaded dynamically based on environment
[mypy-config_validator]
ignore_missing_imports = True

# Database utilities - dynamically loaded based on DB availability
[mypy-db]
ignore_missing_imports = True

# -----------------------------------------------------------------------------
# OPTIONAL DEPENDENCY MODULES: Depend on packages that may not be installed
# These gracefully degrade when their dependencies are unavailable.
# -----------------------------------------------------------------------------

# Kafka event client - requires aiokafka/confluent-kafka (optional)
[mypy-intelligence_event_client]
ignore_missing_imports = True

# Kafka type definitions - used with optional Kafka dependencies
[mypy-kafka_types]
ignore_missing_imports = True

# Kafka RPK CLI wrapper - optional for environments without rpk
[mypy-kafka_rpk_client]
ignore_missing_imports = True

# -----------------------------------------------------------------------------
# AGENT FRAMEWORK MODULES: Part of the polymorphic agent plugin system
# These are loaded at runtime based on agent definitions in ~/.claude/
# -----------------------------------------------------------------------------

# Trigger pattern matching for agent routing
[mypy-trigger_matcher]
ignore_missing_imports = True

# Task classification for agent selection
[mypy-task_classifier]
ignore_missing_imports = True

# Action logging for agent observability
[mypy-action_logger]
ignore_missing_imports = True

# Trace logging for distributed tracing
[mypy-trace_logger]
ignore_missing_imports = True

# Agent dispatch coordinator
[mypy-agent_dispatcher]
ignore_missing_imports = True

# Agent model definitions
[mypy-agent_model]
ignore_missing_imports = True

# Agent code generation utilities
[mypy-agent_code_generator]
ignore_missing_imports = True

# AI quorum for consensus decisions
[mypy-quorum_minimal]
ignore_missing_imports = True

# Interactive validation for agent workflows
[mypy-interactive_validator]
ignore_missing_imports = True

# Code extraction from LLM responses
[mypy-code_extractor]
ignore_missing_imports = True

# Documentation generation
[mypy-doc_generator]
ignore_missing_imports = True

# Structured JSON logging
[mypy-structured_logger]
ignore_missing_imports = True

# LRU result caching
[mypy-result_cache]
ignore_missing_imports = True

# Quality gate event publishing
[mypy-quality_gate_publisher]
ignore_missing_imports = True

# PII sanitization for logs
[mypy-pii_sanitizer]
ignore_missing_imports = True

# Pattern quality scoring
[mypy-pattern_quality_scorer]
ignore_missing_imports = True

# Intelligence usage tracking
[mypy-intelligence_usage_tracker]
ignore_missing_imports = True

# Intelligence result caching
[mypy-intelligence_cache]
ignore_missing_imports = True

# Data sanitization utilities
[mypy-data_sanitizer]
ignore_missing_imports = True

# Confidence scoring for agent routing
[mypy-confidence_scorer]
ignore_missing_imports = True

# Agent capability indexing
[mypy-capability_index]
ignore_missing_imports = True

# Agent routing logic
[mypy-agent_router]
ignore_missing_imports = True

# Database integration layer
[mypy-database_integration]
ignore_missing_imports = True

# =============================================================================
# Agent definition modules - runtime-loaded plugins
# =============================================================================
# These agent definitions are discovered and loaded dynamically from
# ~/.claude/agent-definitions/ at runtime. They follow the polymorphic agent
# pattern and are not available at static analysis time.

[mypy-agent_architect]
ignore_missing_imports = True

[mypy-agent_registry]
ignore_missing_imports = True

[mypy-context_manager]
ignore_missing_imports = True

[mypy-agent_analyzer]
ignore_missing_imports = True

[mypy-agent_researcher]
ignore_missing_imports = True

[mypy-agent_validator]
ignore_missing_imports = True

[mypy-agent_debug_intelligence]
ignore_missing_imports = True

[mypy-agent_refactoring]
ignore_missing_imports = True

[mypy-agent_testing]
ignore_missing_imports = True

[mypy-agent_coder]
ignore_missing_imports = True

[mypy-agent_coder_pydantic]
ignore_missing_imports = True

[mypy-agent_coder_old]
ignore_missing_imports = True

# =============================================================================
# Additional external libraries without type stubs
# =============================================================================
# Third-party packages that don't provide type information.

# Database drivers
[mypy-asyncpg.*]
ignore_missing_imports = True

# Async utilities
[mypy-nest_asyncio]
ignore_missing_imports = True

# Additional Kafka client
[mypy-kafka.*]
ignore_missing_imports = True

# Scientific computing (used in embeddings/analytics)
[mypy-sklearn.*]
ignore_missing_imports = True

[mypy-numpy.*]
ignore_missing_imports = True

[mypy-pandas.*]
ignore_missing_imports = True

# =============================================================================
# PERIODIC TYPE CHECKING STRATEGY
# =============================================================================
# This configuration balances practical development with type safety by ignoring
# imports that cannot be resolved due to missing stubs or dynamic loading.
#
# WHY IGNORES ARE USED:
#   - External libraries: Missing py.typed markers or type stubs (e.g., aiokafka)
#   - Internal modules: Dynamic imports, plugin architecture, optional dependencies
#   - See detailed rationale in the "Internal modules" section above
#
# WHEN TO RECONSIDER IGNORES:
#   - When external libraries release type stubs (check typeshed or pypi)
#   - When refactoring dynamic imports to static imports
#   - When optional dependencies become required
#   - During major version upgrades of dependencies
#   - Quarterly review as part of maintenance cycle
#
# PERIODIC STRICTER CHECKS (run quarterly or before major releases):
#
#   # Full strict check - identifies all potential type issues
#   mypy --strict agents/ config/ claude_hooks/ 2>&1 | head -100
#
#   # Check if any ignored packages now have type stubs
#   for pkg in aiokafka confluent-kafka qdrant-client anthropic asyncpg; do
#       pip index versions types-$pkg 2>/dev/null && echo "Stubs available for $pkg"
#   done
#
#   # Count current ignores (track reduction over time)
#   grep -c "ignore_missing_imports = True" mypy.ini
#
#   # Check for unused ignores (packages no longer used)
#   grep "\[mypy-" mypy.ini | sed 's/\[mypy-\(.*\)\]/\1/' | while read mod; do
#       grep -r "import.*$mod" agents/ config/ claude_hooks/ || echo "Unused: $mod"
#   done
#
# SUCCESS METRIC: Reduce ignore count by 10% per quarter.
# CURRENT COUNT: ~50 module ignores (as of 2025-11-26)
# =============================================================================
