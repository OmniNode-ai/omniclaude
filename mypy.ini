[mypy]
# =============================================================================
# MYPY TYPE CHECKING CONFIGURATION - OmniClaude
# =============================================================================
#
# OWNERSHIP & MAINTENANCE:
#   - Owner: Engineering team / code reviewers
#   - Review: Quarterly (or when adding new ignores)
#   - Last Review: 2025-11-26
#   - Next Review: 2026-02-26
#
# APPROVAL REQUIRED FOR CHANGES:
#   - Adding new module ignores: PR review explaining WHY
#   - Adding exclusion patterns: Must document reasoning
#   - Removing ignores: Encouraged (improves type safety)
#
# GOAL: Gradually reduce ignores as type coverage improves.
# =============================================================================

# General settings
python_version = 3.12

# Tell mypy where to find the omniclaude package
# This enables type checking without needing to install the package
mypy_path = src
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = False
disallow_incomplete_defs = False
check_untyped_defs = True
warn_redundant_casts = True
warn_unused_ignores = True
warn_no_return = True
warn_unreachable = True
strict_optional = True
show_error_codes = True
show_column_numbers = True
pretty = True

# =============================================================================
# EXCLUSION PATTERNS - SIMPLIFIED
# =============================================================================
# Focus on core library type safety first. These exclusions are organized by
# category with explicit justification for each group.
#
# CATEGORIES:
#   1. Test files - Lower priority than production code, many dynamic patterns
#   2. Templates - Code generation templates with placeholders (not valid Python)
#   3. Examples - Demo/example files not shipped in production
#   4. Legacy - Modules scheduled for deprecation or refactoring
#   5. Generated - Files created dynamically by agent system at runtime
#
# NOTE: skills/ directory is NOT excluded - it contains production code that
# should be type-checked. If skills need exclusion, add explicit pattern.
# =============================================================================
exclude = (?x)(
    # --- TEST FILES ---
    # Consolidated pattern: matches test_*.py anywhere and test directories.
    # Lower priority than production code; enable incrementally as tests mature.
      ^.*/tests/
    | /test_[^/]+\.py$
    | ^claude_hooks/modified_performance_test\.py$

    # --- CODE GENERATION TEMPLATES ---
    # agents/templates/ contains Python files with {PLACEHOLDER} syntax for
    # code generation (e.g., compute_node_template.py). These are NOT valid
    # Python and cannot be type-checked.
    # Note: agents/parallel_execution/templates/ contains VALID Python
    # (template strings stored in .py files) - could be enabled in future.
    | ^agents/templates/

    # --- EXAMPLES ---
    # Consolidated pattern: demo/example code not shipped in production.
      | /examples?/
    | _example\.py$

    # --- LEGACY ---
    # Modules scheduled for deprecation or major refactoring.
    # TODO: Remove after refactoring completes.
    | ^agents/lib/legacy/
    | ^agents/lib/codegen_workflow\.py$

    # --- RUNTIME-GENERATED FILES ---
    # Created dynamically by dispatch_runner during parallel agent execution.
    # These files exist only temporarily and may not be present at analysis time.
    | ^agents/parallel_execution/agent_[^/]+\.py$
    | ^agents/parallel_execution/generate_[^/]+\.py$
    | ^agents/parallel_execution/dispatch_runner\.py$
    | ^agents/parallel_execution/db_connection_pool\.py$

    # --- CLAUDE HOOKS DYNAMIC MODULES ---
    # Config and memory modules loaded dynamically based on environment.
    | ^claude_hooks/config/
    | ^claude_hooks/lib/memory/
    )

# Use explicit package bases to avoid module conflicts
explicit_package_bases = True

# =============================================================================
# IGNORE STRATEGY FOR MISSING IMPORTS
# =============================================================================
#
# WHY IGNORES ARE NEEDED:
#   This project uses a polymorphic agent system with dynamic module loading.
#   Many modules are imported via bare imports (e.g., `import action_logger`)
#   after sys.path is modified at runtime. Mypy cannot resolve these statically.
#
# THREE CATEGORIES OF IGNORES:
#   1. EXTERNAL LIBRARIES - Third-party packages without py.typed markers
#   2. BARE IMPORT MODULES - Internal modules imported without package prefix
#   3. AGENT PLUGINS - Runtime-loaded agent definitions from ~/.claude/
#
# GRADUAL ENABLEMENT STRATEGY:
#   Phase 1 (Current): Ignore all problematic imports to unblock development
#   Phase 2 (Next):    Add .pyi stubs for critical internal modules
#   Phase 3 (Future):  Refactor bare imports to use package-qualified imports
#
# HOW TO REDUCE IGNORES:
#   - For external libs: Check if stubs exist (pip install types-<package>)
#   - For bare imports: Refactor to `from agents.lib import <module>`
#   - For plugins: Consider type stubs in ~/.claude/stubs/
#
# CURRENT IGNORE COUNT: 64 modules (target: reduce by 10% quarterly)
# =============================================================================

# =============================================================================
# EXTERNAL LIBRARIES WITHOUT TYPE STUBS
# =============================================================================
# Third-party packages that don't ship with type annotations or py.typed
# markers. Check typeshed periodically for new stubs.
#
# To check for available stubs:
#   pip index versions types-<package> 2>/dev/null

# --- Internal OmniNode packages (no py.typed yet) ---
[mypy-omnibase_core.*]
ignore_missing_imports = True

[mypy-omnibase_spi.*]
ignore_missing_imports = True

[mypy-omnibase_infra.*]
ignore_missing_imports = True

# --- Local omniclaude package (src layout, not installed) ---
# The package is in src/omniclaude/ with proper __init__.py structure.
# Without py.typed (which causes module conflicts), mypy needs explicit ignore.
# TODO: Fix py.typed conflict in pyproject.toml package configuration
[mypy-omniclaude.*]
ignore_missing_imports = True

# --- LangChain/LangGraph ecosystem ---
[mypy-langgraph.*]
ignore_missing_imports = True

[mypy-langchain.*]
ignore_missing_imports = True

[mypy-langchain_core.*]
ignore_missing_imports = True

# --- Kafka clients ---
[mypy-aiokafka.*]
ignore_missing_imports = True

[mypy-confluent_kafka.*]
ignore_missing_imports = True

[mypy-kafka.*]
ignore_missing_imports = True

# --- AI/ML libraries ---
[mypy-qdrant_client.*]
ignore_missing_imports = True

[mypy-anthropic.*]
ignore_missing_imports = True

[mypy-google.generativeai.*]
ignore_missing_imports = True

# --- Database drivers ---
[mypy-asyncpg.*]
ignore_missing_imports = True

# --- Scientific computing (embeddings/analytics) ---
[mypy-sklearn.*]
ignore_missing_imports = True

[mypy-numpy.*]
ignore_missing_imports = True

[mypy-pandas.*]
ignore_missing_imports = True

# --- Async utilities ---
[mypy-nest_asyncio]
ignore_missing_imports = True

[mypy-aiohttp.*]
ignore_missing_imports = True

# --- Configuration/Settings ---
[mypy-dotenv]
ignore_missing_imports = True

[mypy-pydantic_settings]
ignore_missing_imports = True

# --- Caching/Redis ---
[mypy-redis.*]
ignore_missing_imports = True

# --- MCP SDK ---
[mypy-mcp_client.*]
ignore_missing_imports = True

# =============================================================================
# BARE IMPORT MODULES - Internal Code with Runtime sys.path Modification
# =============================================================================
# These modules exist in agents/lib/ or claude_hooks/lib/ but are imported
# as bare imports (e.g., `import action_logger` instead of
# `from agents.lib import action_logger`). This happens because scripts
# modify sys.path at runtime to include these directories.
#
# FIX: Refactor to use package-qualified imports. Then remove these ignores.
# TRACKING: Each module lists its actual location in the codebase.
# =============================================================================

# --- Core utilities (agents/lib/) ---
# Location: agents/lib/import_utils.py
[mypy-import_utils]
ignore_missing_imports = True

# Location: agents/lib/config_validator.py
[mypy-config_validator]
ignore_missing_imports = True

# Location: agents/lib/db.py
[mypy-db]
ignore_missing_imports = True

# Location: agents/lib/structured_logger.py
[mypy-structured_logger]
ignore_missing_imports = True

# Location: agents/lib/result_cache.py
[mypy-result_cache]
ignore_missing_imports = True

# Location: agents/lib/data_sanitizer.py
[mypy-data_sanitizer]
ignore_missing_imports = True

# --- Kafka integration (agents/lib/) ---
# Location: agents/lib/intelligence_event_client.py
[mypy-intelligence_event_client]
ignore_missing_imports = True

# Location: agents/lib/kafka_rpk_client.py
[mypy-kafka_rpk_client]
ignore_missing_imports = True

# Kafka type definitions (may be generated)
[mypy-kafka_types]
ignore_missing_imports = True

# --- Agent routing (agents/lib/) ---
# Location: agents/lib/trigger_matcher.py
[mypy-trigger_matcher]
ignore_missing_imports = True

# Location: agents/lib/task_classifier.py
[mypy-task_classifier]
ignore_missing_imports = True

# Location: agents/lib/confidence_scorer.py
[mypy-confidence_scorer]
ignore_missing_imports = True

# Location: agents/lib/agent_router.py
[mypy-agent_router]
ignore_missing_imports = True

# --- Observability (agents/lib/) ---
# Location: agents/lib/action_logger.py
[mypy-action_logger]
ignore_missing_imports = True

[mypy-trace_logger]
ignore_missing_imports = True

# Location: agents/lib/pattern_quality_scorer.py
[mypy-pattern_quality_scorer]
ignore_missing_imports = True

[mypy-intelligence_usage_tracker]
ignore_missing_imports = True

[mypy-intelligence_cache]
ignore_missing_imports = True

[mypy-quality_gate_publisher]
ignore_missing_imports = True

[mypy-pii_sanitizer]
ignore_missing_imports = True

# --- Code generation (agents/lib/) ---
[mypy-agent_code_generator]
ignore_missing_imports = True

[mypy-code_extractor]
ignore_missing_imports = True

[mypy-doc_generator]
ignore_missing_imports = True

# --- Agent framework utilities ---
[mypy-agent_dispatcher]
ignore_missing_imports = True

[mypy-agent_model]
ignore_missing_imports = True

[mypy-quorum_minimal]
ignore_missing_imports = True

[mypy-interactive_validator]
ignore_missing_imports = True

[mypy-capability_index]
ignore_missing_imports = True

[mypy-database_integration]
ignore_missing_imports = True

# --- Claude hooks bare imports (claude_hooks/lib/) ---
# Location: claude_hooks/lib/resilience.py
[mypy-lib.resilience]
ignore_missing_imports = True

# --- Archived module imports (src/omniclaude/lib/ references) ---
# These patterns cover imports from archived modules that lib files still reference.
# The modules existed in the original agents/ and schemas/ directories before archival.
# Note: Explicit module names used because mypy wildcard patterns don't work reliably
#       for these non-existent package paths.

# agents.lib.* modules
[mypy-agents.lib.errors]
ignore_missing_imports = True

[mypy-agents.lib.transformation_event_publisher]
ignore_missing_imports = True

[mypy-agents.lib.slack_notifier]
ignore_missing_imports = True

[mypy-agents.lib.prometheus_metrics]
ignore_missing_imports = True

[mypy-agents.lib.agent_execution_logger]
ignore_missing_imports = True

[mypy-agents.lib.intelligence_usage_tracker]
ignore_missing_imports = True

[mypy-agents.lib.pattern_quality_scorer]
ignore_missing_imports = True

[mypy-agents.lib.task_classifier]
ignore_missing_imports = True

[mypy-agents.lib.data_sanitizer]
ignore_missing_imports = True

# agents.lib.config.* modules
[mypy-agents.lib.config.intelligence_config]
ignore_missing_imports = True

# agents.lib.models.* modules
[mypy-agents.lib.models.intelligence_context]
ignore_missing_imports = True

# schemas.* modules
[mypy-schemas.model_routing_event_envelope]
ignore_missing_imports = True

[mypy-schemas.model_routing_request]
ignore_missing_imports = True

# lib.* modules (non-prefixed)
[mypy-lib.tool_selection_intelligence]
ignore_missing_imports = True

# =============================================================================
# AGENT PLUGIN MODULES - Runtime-Loaded from ~/.claude/agent-definitions/
# =============================================================================
# These agent definitions follow the polymorphic agent pattern and are
# discovered/loaded dynamically at runtime. They are not available for
# static analysis because they live outside the repository.
#
# ALTERNATIVE: Create .pyi stubs in a stubs/ directory if type safety needed.
# =============================================================================

[mypy-agent_architect]
ignore_missing_imports = True

[mypy-agent_registry]
ignore_missing_imports = True

[mypy-context_manager]
ignore_missing_imports = True

[mypy-agent_analyzer]
ignore_missing_imports = True

[mypy-agent_researcher]
ignore_missing_imports = True

[mypy-agent_validator]
ignore_missing_imports = True

[mypy-agent_debug_intelligence]
ignore_missing_imports = True

[mypy-agent_refactoring]
ignore_missing_imports = True

[mypy-agent_testing]
ignore_missing_imports = True

[mypy-agent_coder]
ignore_missing_imports = True

[mypy-agent_coder_pydantic]
ignore_missing_imports = True

[mypy-agent_coder_old]
ignore_missing_imports = True

# =============================================================================
# QUARTERLY REVIEW CHECKLIST
# =============================================================================
# Run these commands during quarterly reviews to identify opportunities to
# reduce ignores and improve type coverage.
#
# 1. CHECK FOR NEW TYPE STUBS:
#    for pkg in aiokafka confluent-kafka qdrant-client anthropic asyncpg; do
#        pip index versions types-$pkg 2>/dev/null && echo "Stubs available: $pkg"
#    done
#
# 2. COUNT CURRENT IGNORES (track trend):
#    grep -c "ignore_missing_imports = True" mypy.ini
#
# 3. FIND UNUSED IGNORES (packages no longer imported):
#    grep "\[mypy-" mypy.ini | sed 's/\[mypy-\(.*\)\]/\1/' | while read mod; do
#        grep -rq "import.*$mod" agents/ config/ claude_hooks/ || echo "Unused: $mod"
#    done
#
# 4. RUN STRICT CHECK (identify type improvement opportunities):
#    mypy --strict agents/ config/ claude_hooks/ 2>&1 | head -100
#
# METRICS:
#   - Target: Reduce ignore count by 10% per quarter
#   - Current count: 64 module ignores (as of 2025-11-26)
#     - External libraries: 22 (third-party without stubs)
#     - Bare imports: 30 (internal modules with sys.path modification)
#     - Agent plugins: 12 (runtime-loaded from ~/.claude/)
# =============================================================================

# --- Additional bare imports from lib files ---
# These are bare imports used by reclaimed lib modules
[mypy-manifest_injector]
ignore_missing_imports = True

[mypy-archon_intelligence]
ignore_missing_imports = True

# --- Module with conditional imports (environment-dependent type ignore) ---
# errors.py has fallback class definitions used when omnibase_core is unavailable.
# In CI (no omnibase_core), type: ignore[misc] is needed for subclassing Any.
# Locally (omnibase_core installed), the ignore is "unused".
# Disable warn_unused_ignores for this file to handle both environments.
[mypy-omniclaude.lib.errors]
warn_unused_ignores = False

# --- External library without stubs ---
[mypy-libcst]
ignore_missing_imports = True
