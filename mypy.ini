[mypy]
# General settings
python_version = 3.12
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = False
disallow_incomplete_defs = False
check_untyped_defs = True
warn_redundant_casts = True
warn_unused_ignores = True
warn_no_return = True
warn_unreachable = True
strict_optional = True
show_error_codes = True
show_column_numbers = True
pretty = True

# Exclude template files, tests, examples, and utilities
# Focus on core library type safety first - these exclusions are for:
# - Test files (many type errors, lower priority)
# - Example/demo files (not production code)
# - Generated code and templates
# - Legacy modules scheduled for deprecation
exclude = (?x)(
    ^agents/templates/
    | ^agents/tests/
    | ^agents/examples/
    | ^agents/lib/test_[^/]+\.py$
    | ^agents/lib/legacy/
    | ^agents/lib/example_[^/]+\.py$
    | ^agents/lib/partition_key_policy_example\.py$
    | ^agents/parallel_execution/agent_[^/]+\.py$
    | ^agents/parallel_execution/generate_[^/]+\.py$
    | ^agents/parallel_execution/dispatch_runner\.py$
    | ^agents/parallel_execution/db_connection_pool\.py$
    | ^agents/parallel_execution/templates/
    | ^agents/parallel_execution/test_[^/]+\.py$
    | ^claude_hooks/config/
    | ^claude_hooks/tests/
    | ^claude_hooks/examples/
    | ^claude_hooks/lib/memory/
    | ^claude_hooks/modified_performance_test\.py$
    | ^agents/lib/codegen_workflow\.py$
    )

# Use explicit package bases to avoid module conflicts
explicit_package_bases = True

# =============================================================================
# External libraries without type stubs
# =============================================================================
# These are third-party packages that don't ship with type annotations or
# py.typed markers. We ignore missing imports to avoid mypy errors.
[mypy-omnibase_core.*]
ignore_missing_imports = True

[mypy-omnibase_spi.*]
ignore_missing_imports = True

[mypy-langgraph.*]
ignore_missing_imports = True

[mypy-langchain.*]
ignore_missing_imports = True

[mypy-langchain_core.*]
ignore_missing_imports = True

[mypy-aiokafka.*]
ignore_missing_imports = True

[mypy-confluent_kafka.*]
ignore_missing_imports = True

[mypy-qdrant_client.*]
ignore_missing_imports = True

[mypy-anthropic.*]
ignore_missing_imports = True

[mypy-google.generativeai.*]
ignore_missing_imports = True

# =============================================================================
# Internal modules with dynamic imports or optional dependencies
# =============================================================================
# RATIONALE: These modules are part of the OmniClaude codebase but are ignored
# for one or more of the following reasons:
#
# 1. DYNAMIC IMPORTS: Modules loaded dynamically at runtime via importlib or
#    __import__. Mypy cannot trace these import chains statically.
#
# 2. OPTIONAL DEPENDENCIES: Modules that depend on optional packages (e.g.,
#    omnibase_core, langgraph) which may not be installed in all environments.
#
# 3. GENERATED CODE: Modules generated by the agent system or code generation
#    workflows that may not exist at static analysis time.
#
# 4. PLUGIN ARCHITECTURE: Agent plugins and extensions that are discovered and
#    loaded at runtime from the ~/.claude/agent-definitions/ registry.
#
# 5. CIRCULAR IMPORT AVOIDANCE: Some modules use late binding to avoid circular
#    imports, which mypy cannot fully resolve.
#
# MAINTENANCE: When adding new internal modules here, document WHY they need
# ignore_missing_imports. Prefer fixing type issues over adding ignores.
# =============================================================================
#
# Per-module justifications are provided inline below. Each module requires
# ignore_missing_imports for a specific documented reason.
# =============================================================================

# MCP (Model Context Protocol) client - third-party MCP SDK without type stubs
[mypy-mcp_client.*]
ignore_missing_imports = True

# lib.resilience - claude_hooks internal module with bare imports resolved at runtime
# The claude_hooks package modifies sys.path to enable bare imports like `from lib.resilience`
[mypy-lib.resilience]
ignore_missing_imports = True

# -----------------------------------------------------------------------------
# DYNAMIC IMPORT MODULES: Loaded via importlib at runtime, not static imports
# These use bare imports (e.g., `import import_utils`) discovered dynamically.
# -----------------------------------------------------------------------------

# Dynamic module loader - uses importlib to discover modules at runtime
[mypy-import_utils]
ignore_missing_imports = True

# Configuration validation - loaded dynamically based on environment
[mypy-config_validator]
ignore_missing_imports = True

# Database utilities - dynamically loaded based on DB availability
[mypy-db]
ignore_missing_imports = True

# -----------------------------------------------------------------------------
# OPTIONAL DEPENDENCY MODULES: Depend on packages that may not be installed
# These gracefully degrade when their dependencies are unavailable.
# -----------------------------------------------------------------------------

# Kafka event client - requires aiokafka/confluent-kafka (optional)
[mypy-intelligence_event_client]
ignore_missing_imports = True

# Kafka type definitions - used with optional Kafka dependencies
[mypy-kafka_types]
ignore_missing_imports = True

# Kafka RPK CLI wrapper - optional for environments without rpk
[mypy-kafka_rpk_client]
ignore_missing_imports = True

# -----------------------------------------------------------------------------
# AGENT FRAMEWORK MODULES: Part of the polymorphic agent plugin system
# These are loaded at runtime based on agent definitions in ~/.claude/
# -----------------------------------------------------------------------------

# Trigger pattern matching for agent routing
[mypy-trigger_matcher]
ignore_missing_imports = True

# Task classification for agent selection
[mypy-task_classifier]
ignore_missing_imports = True

# Action logging for agent observability
[mypy-action_logger]
ignore_missing_imports = True

# Trace logging for distributed tracing
[mypy-trace_logger]
ignore_missing_imports = True

# Agent dispatch coordinator
[mypy-agent_dispatcher]
ignore_missing_imports = True

# Agent model definitions
[mypy-agent_model]
ignore_missing_imports = True

# Agent code generation utilities
[mypy-agent_code_generator]
ignore_missing_imports = True

# AI quorum for consensus decisions
[mypy-quorum_minimal]
ignore_missing_imports = True

# Interactive validation for agent workflows
[mypy-interactive_validator]
ignore_missing_imports = True

# Code extraction from LLM responses
[mypy-code_extractor]
ignore_missing_imports = True

# Documentation generation
[mypy-doc_generator]
ignore_missing_imports = True

# Structured JSON logging
[mypy-structured_logger]
ignore_missing_imports = True

# LRU result caching
[mypy-result_cache]
ignore_missing_imports = True

# Quality gate event publishing
[mypy-quality_gate_publisher]
ignore_missing_imports = True

# PII sanitization for logs
[mypy-pii_sanitizer]
ignore_missing_imports = True

# Pattern quality scoring
[mypy-pattern_quality_scorer]
ignore_missing_imports = True

# Intelligence usage tracking
[mypy-intelligence_usage_tracker]
ignore_missing_imports = True

# Intelligence result caching
[mypy-intelligence_cache]
ignore_missing_imports = True

# Data sanitization utilities
[mypy-data_sanitizer]
ignore_missing_imports = True

# Confidence scoring for agent routing
[mypy-confidence_scorer]
ignore_missing_imports = True

# Agent capability indexing
[mypy-capability_index]
ignore_missing_imports = True

# Agent routing logic
[mypy-agent_router]
ignore_missing_imports = True

# Database integration layer
[mypy-database_integration]
ignore_missing_imports = True

# =============================================================================
# Agent definition modules - runtime-loaded plugins
# =============================================================================
# These agent definitions are discovered and loaded dynamically from
# ~/.claude/agent-definitions/ at runtime. They follow the polymorphic agent
# pattern and are not available at static analysis time.

[mypy-agent_architect]
ignore_missing_imports = True

[mypy-agent_registry]
ignore_missing_imports = True

[mypy-context_manager]
ignore_missing_imports = True

[mypy-agent_analyzer]
ignore_missing_imports = True

[mypy-agent_researcher]
ignore_missing_imports = True

[mypy-agent_validator]
ignore_missing_imports = True

[mypy-agent_debug_intelligence]
ignore_missing_imports = True

[mypy-agent_refactoring]
ignore_missing_imports = True

[mypy-agent_testing]
ignore_missing_imports = True

[mypy-agent_coder]
ignore_missing_imports = True

[mypy-agent_coder_pydantic]
ignore_missing_imports = True

[mypy-agent_coder_old]
ignore_missing_imports = True

# =============================================================================
# Additional external libraries without type stubs
# =============================================================================
# Third-party packages that don't provide type information.

# Database drivers
[mypy-asyncpg.*]
ignore_missing_imports = True

# Async utilities
[mypy-nest_asyncio]
ignore_missing_imports = True

# Additional Kafka client
[mypy-kafka.*]
ignore_missing_imports = True

# Scientific computing (used in embeddings/analytics)
[mypy-sklearn.*]
ignore_missing_imports = True

[mypy-numpy.*]
ignore_missing_imports = True

[mypy-pandas.*]
ignore_missing_imports = True

# =============================================================================
# PERIODIC TYPE CHECKING STRATEGY
# =============================================================================
# This configuration balances practical development with type safety by ignoring
# imports that cannot be resolved due to missing stubs or dynamic loading.
#
# WHY IGNORES ARE USED:
#   - External libraries: Missing py.typed markers or type stubs (e.g., aiokafka)
#   - Internal modules: Dynamic imports, plugin architecture, optional dependencies
#   - See detailed rationale in the "Internal modules" section above (lines 72-99)
#
# WHEN TO RECONSIDER:
#   - When external libraries release type stubs (check typeshed or pypi)
#   - When refactoring dynamic imports to static imports
#   - When optional dependencies become required
#   - During major version upgrades of dependencies
#
# PERIODIC STRICTER CHECKS:
#   Run these commands periodically to identify potential improvements:
#
#   # Full strict check (will show all potential issues)
#   mypy --strict agents/ config/ claude_hooks/ 2>&1 | head -100
#
#   # Check specific ignored modules for new type stubs
#   pip show <package> | grep -i "type"
#
#   # List packages with type stubs available
#   pip index versions types-<package> 2>/dev/null
#
# GOAL: Gradually reduce ignores as type coverage improves in dependencies.
# =============================================================================
