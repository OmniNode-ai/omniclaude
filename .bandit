[bandit]
# Bandit security configuration for OmniClaude
# INI format required (not YAML)
#
# NOTE: This file is the primary source of truth for Bandit configuration.
# Keep in sync with:
#   - pyproject.toml [tool.bandit] section
#   - CI workflow exclusions in .github/workflows/ci-cd.yml
#   - Documentation in docs/security/BANDIT_CONFIGURATION.md

# Exclude directories from scanning
# Uses project-relative paths (not absolute paths with leading /)
exclude_dirs = agents/templates,agents/parallel_execution/templates,agents/tests,claude_hooks/tests,skills,.venv,__pycache__,build,dist

# =============================================================================
# Skip specific test IDs - ORGANIZED BY SIGNAL LEVEL
# =============================================================================
#
# IMPORTANT: High-signal security checks should NOT be globally skipped.
# Use inline `# nosec B<ID>` comments for specific, justified exceptions.
#
# -----------------------------------------------------------------------------
# GLOBALLY SKIPPED (LOW-SIGNAL / HIGH FALSE POSITIVE RATE):
# -----------------------------------------------------------------------------
#
# B101 - assert_used
#        Reason: Assertions in test code are expected. Tests are excluded from
#        Bandit scans via exclude_dirs.
#        NOTE: Production code should NOT use assertions for validation.
#        Assertions can be disabled with `python -O` making them unreliable.
#        Use proper error handling (if x is None: raise ValueError(...)) instead.
#        Run periodic scans with B101 enabled: `bandit -r . -x tests`
#
# B104 - hardcoded_bind_all_interfaces (0.0.0.0)
#        Reason: Development/staging environments intentionally bind to all
#        interfaces. Production deployments use proper network isolation.
#
# B105 - hardcoded_password_string
# B106 - hardcoded_password_funcarg
# B107 - hardcoded_password_default
#        Reason: High false positive rate on variable names like "password",
#        "api_key", "token" even when values come from environment. Real
#        secrets are loaded from .env and never committed (verified by
#        pre-commit hooks).
#
# B108 - hardcoded_tmp_directory
#        Reason: /tmp usage is controlled and cleaned up. No sensitive data
#        persisted in temporary directories.
#
# B201 - flask_debug_true
#        Reason: Debug mode is controlled via environment variables and
#        never enabled in production deployments.
#
# B311 - random
#        Reason: random module is only used for non-security purposes
#        (e.g., jitter, sampling). Cryptographic randomness uses secrets module.
#
# B404 - subprocess_import
#        Reason: subprocess is required for system integration (git, npm,
#        docker commands). All inputs are validated before execution.
#
# B603 - subprocess_without_shell_equals_true
#        Reason: We explicitly use shell=False where possible and validate
#        all command arguments. Commands are constructed programmatically.
#
# B607 - start_process_with_partial_path
#        Reason: Development environment uses PATH-resolved commands. In
#        production, full paths would be used via configuration.
#
# -----------------------------------------------------------------------------
# HIGH-SIGNAL CHECKS - NOW ENABLED:
# -----------------------------------------------------------------------------
# These checks were previously skipped but are now ENABLED because they catch
# real security issues. Use `# nosec B<ID>` inline for justified exceptions.
#
# B110 - try_except_pass (NOW ENABLED)
#        Why enabled: Silent exception handling can hide bugs and security
#        issues like failed authentication, connection errors, or data
#        corruption. Forces developers to explicitly acknowledge exceptions.
#        Acceptable cases: Optional imports, graceful degradation with fallback.
#        Usage: Add `# nosec B110 - <reason>` for justified silent catches.
#
# B608 - sql_statements_without_placeholders (NOW ENABLED)
#        Why enabled: SQL injection is a critical vulnerability (OWASP Top 10).
#        All SQL should use parameterized queries ($1, %s, ?) not f-strings.
#        Acceptable cases: Static table names, identifier quoting with validation.
#        Usage: Add `# nosec B608 - <reason>` for validated dynamic identifiers.
#
# =============================================================================
# PERIODIC FULL SECURITY AUDIT
# =============================================================================
# Run periodic scans WITHOUT skips to catch issues that may slip through:
#
#   # Full scan without any skips (may have false positives)
#   bandit -r agents config claude_hooks -f json -o bandit_full_audit.json
#
#   # Scan with only high-signal checks enabled
#   bandit -r agents config claude_hooks --skip B104,B108,B201,B311
#
# Schedule these audits monthly or before major releases.
# =============================================================================

skips = B101,B104,B105,B106,B107,B108,B201,B311,B404,B603,B607
