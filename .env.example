# =============================================================================
# OmniClaude Environment Configuration
# =============================================================================
# Copy this file to .env and configure for your environment:
#   cp .env.example .env
#   nano .env
#   source .env
#
# CONFIGURATION CONVENTION:
#   # REQUIRED: <description>     - App fails without this value
#   # OPTIONAL: <description>     - Has a safe default, override only if needed
#   # CONDITIONAL: <description>  - Required only if related feature is enabled
#
# FAIL-FAST DESIGN:
#   This configuration follows fail-fast principles. Services default to
#   DISABLED until explicitly configured. This prevents silent localhost
#   connections in production environments.
#
#   To enable a service, you MUST:
#   1. Set the enable flag to true (e.g., ENABLE_POSTGRES=true)
#   2. Provide ALL required connection details
#
# FOR LOCAL DEVELOPMENT:
#   If you don't have external services, leave enable flags as false.
#   The app will run with reduced functionality but won't fail.
# =============================================================================

# =============================================================================
# KAFKA / REDPANDA EVENT BUS
# =============================================================================
# OmniClaude uses Kafka for event-driven architecture and learning loops.
# If you don't have Kafka, set USE_EVENT_ROUTING=false to disable.

# CONDITIONAL: Required if USE_EVENT_ROUTING=true
# Format: host:port (e.g., localhost:9092, your-kafka-server:29092)
# No default - must be explicitly configured when event routing is enabled
KAFKA_BOOTSTRAP_SERVERS=

# CONDITIONAL: Required if USE_EVENT_ROUTING=true
# Topic environment prefix - MUST be explicit to prevent cross-environment routing
# Values: dev, staging, prod
# No default - you must specify your environment
KAFKA_ENVIRONMENT=

# OPTIONAL: Legacy alias for KAFKA_BOOTSTRAP_SERVERS (deprecated, use above)
# KAFKA_INTELLIGENCE_BOOTSTRAP_SERVERS=

# OPTIONAL: Kafka consumer group identifier
# Default: omniclaude-hooks
KAFKA_GROUP_ID=omniclaude-hooks

# OPTIONAL: Kafka request timeout in milliseconds (100-60000)
# Default: 5000
KAFKA_REQUEST_TIMEOUT_MS=5000

# =============================================================================
# OMNICLAUDE DATABASE (PREFERRED)
# =============================================================================
# Full connection URL for omniclaude's own database.
# When set, takes precedence over individual POSTGRES_* fields below.
# Format: postgresql://user:password@host:port/dbname
# OMNICLAUDE_DB_URL=postgresql://role_omniclaude:password@192.168.86.200:5436/omniclaude

# =============================================================================
# POSTGRESQL DATABASE
# =============================================================================
# PostgreSQL stores hook events, agent routing decisions, and learning data.
# DISABLED BY DEFAULT - set ENABLE_POSTGRES=true to enable.

# OPTIONAL: Enable PostgreSQL database connection
# When true, ALL POSTGRES_* fields below are REQUIRED (unless OMNICLAUDE_DB_URL is set)
# Default: false (safe for local development without database)
ENABLE_POSTGRES=false

# CONDITIONAL: Required if ENABLE_POSTGRES=true (and OMNICLAUDE_DB_URL not set)
# PostgreSQL server hostname or IP
POSTGRES_HOST=

# CONDITIONAL: Required if ENABLE_POSTGRES=true (and OMNICLAUDE_DB_URL not set)
# PostgreSQL server port (standard: 5432)
POSTGRES_PORT=

# CONDITIONAL: Required if ENABLE_POSTGRES=true (and OMNICLAUDE_DB_URL not set)
# PostgreSQL database name (default: omniclaude after DB-SPLIT-07)
POSTGRES_DATABASE=

# CONDITIONAL: Required if ENABLE_POSTGRES=true (and OMNICLAUDE_DB_URL not set)
# PostgreSQL username
POSTGRES_USER=

# CONDITIONAL: Required if ENABLE_POSTGRES=true (and OMNICLAUDE_DB_URL not set)
# PostgreSQL password
POSTGRES_PASSWORD=

# =============================================================================
# QDRANT VECTOR DATABASE
# =============================================================================
# Qdrant provides vector similarity search for RAG and pattern discovery.
# DISABLED BY DEFAULT - set ENABLE_QDRANT=true to enable.

# OPTIONAL: Enable Qdrant vector database
# When true, QDRANT_HOST, QDRANT_PORT, and QDRANT_URL are REQUIRED
# Default: false (safe for local development without vector DB)
ENABLE_QDRANT=false

# CONDITIONAL: Required if ENABLE_QDRANT=true
# Qdrant server hostname or IP
QDRANT_HOST=

# CONDITIONAL: Required if ENABLE_QDRANT=true
# Qdrant REST API port (standard: 6333)
QDRANT_PORT=

# CONDITIONAL: Required if ENABLE_QDRANT=true
# Full Qdrant URL (should match QDRANT_HOST and QDRANT_PORT)
QDRANT_URL=

# =============================================================================
# VALKEY / REDIS CACHE
# =============================================================================
# Valkey (Redis-compatible) provides caching for intelligence queries.
# If not configured, caching is disabled gracefully.

# OPTIONAL: Valkey/Redis connection URL
# Format: redis://:password@host:6379/db_number
# Default: None (caching disabled)
# VALKEY_URL=redis://:your_password@localhost:6379/0

# OPTIONAL: Enable intelligence query caching
# Default: true (but no-op if VALKEY_URL not set)
ENABLE_INTELLIGENCE_CACHE=true

# OPTIONAL: Cache TTL for pattern entries (seconds)
# Default: 300 (5 minutes)
CACHE_TTL_PATTERNS=300

# OPTIONAL: Cache TTL for infrastructure entries (seconds)
# Default: 3600 (1 hour)
CACHE_TTL_INFRASTRUCTURE=3600

# OPTIONAL: Cache TTL for schema entries (seconds)
# Default: 1800 (30 minutes)
CACHE_TTL_SCHEMAS=1800

# =============================================================================
# SERVICE URLS
# =============================================================================
# URLs for microservices in the OmniClaude ecosystem.
# All are OPTIONAL - features are disabled gracefully when not configured.

# OPTIONAL: Intelligence service URL for pattern discovery and code analysis
# When not set, intelligence features are disabled
# Default: None
# INTELLIGENCE_SERVICE_URL=http://your-intelligence-server:8053

# OPTIONAL: Main server URL
# When not set, main server features are disabled
# Default: None
# MAIN_SERVER_URL=http://your-main-server:8181

# OPTIONAL: Semantic search service URL for hybrid text/vector search
# When not set, semantic search features are disabled
# Default: None
# SEMANTIC_SEARCH_URL=http://your-search-server:8055

# OPTIONAL: Legacy alias for INTELLIGENCE_SERVICE_URL (deprecated)
# ARCHON_INTELLIGENCE_URL=

# =============================================================================
# FEATURE FLAGS
# =============================================================================
# Control which features are enabled at runtime.

# OPTIONAL: Enable event-based agent routing via Kafka
# When true, KAFKA_BOOTSTRAP_SERVERS and KAFKA_ENVIRONMENT are REQUIRED
# Default: false (safe for local development without Kafka)
USE_EVENT_ROUTING=false

# OPTIONAL: Enable pattern quality filtering
# Default: false
ENABLE_PATTERN_QUALITY_FILTER=false

# OPTIONAL: Minimum pattern quality threshold (0.0-1.0)
# Only applies if ENABLE_PATTERN_QUALITY_FILTER=true
# Default: 0.5
MIN_PATTERN_QUALITY=0.5

# =============================================================================
# A/B COHORT ASSIGNMENT (Pattern Injection Experiments)
# =============================================================================
# Controls A/B testing for pattern injection experiments.
# Sessions are assigned to "control" or "treatment" cohorts based on a
# deterministic hash of the session ID and salt. Control cohort receives
# no pattern injection; treatment cohort receives injected patterns.
#
# SOURCE OF TRUTH: src/omniclaude/hooks/contracts/contract_experiment_cohort.yaml
# These environment variables OVERRIDE contract defaults for ops flexibility.
# Use only for emergency tuning or staged rollout - prefer updating the contract.
# Effective values are stamped into every injection record for auditability.

# OVERRIDE: Percentage of sessions assigned to control cohort (0-100)
# Higher values = more sessions in control (no injection)
# Contract default: 20 (20% control, 80% treatment)
# OMNICLAUDE_COHORT_CONTROL_PERCENTAGE=20

# OVERRIDE: Salt string for hash-based cohort assignment
# Change this value to reset the experiment and re-randomize assignments
# Contract default: omniclaude-injection-v1
# OMNICLAUDE_COHORT_SALT=omniclaude-injection-v1

# =============================================================================
# PATTERN ENFORCEMENT (OMN-2263)
# =============================================================================
# Advisory pattern compliance checking on PostToolUse (Write/Edit).
# Queries OmniIntelligence pattern store, checks session cooldown,
# runs compliance check. All failures are silent (never blocks UX).
# Budget: 300ms. Requires ENABLE_LOCAL_INFERENCE_PIPELINE=true.

# OPTIONAL: Enable local inference pipeline (parent gate for pattern enforcement)
# Default: false
ENABLE_LOCAL_INFERENCE_PIPELINE=false

# OPTIONAL: Enable pattern enforcement advisory checks
# Only active when ENABLE_LOCAL_INFERENCE_PIPELINE=true
# Default: false
ENABLE_PATTERN_ENFORCEMENT=false

# OPTIONAL: Enable ONEX routing nodes (omnibase_core HandlerRoutingDefault et al.)
# Only active when the ONEX node imports succeed at startup.
# Default: false
USE_ONEX_ROUTING_NODES=false

# OPTIONAL: Enable LLM-based agent routing (Qwen2.5-14B via LLM_QWEN_14B_URL)
# Only active when ENABLE_LOCAL_INFERENCE_PIPELINE=true
# Budget: 100ms per step (health check 100ms + LLM call 100ms, ~200ms worst-case).
# Falls through to fuzzy matching on any failure (timeout, unhealthy endpoint,
# unrecognised agent).
# Default: false
USE_LLM_ROUTING=false

# Priority order when multiple routing strategies are enabled:
#   1. USE_ONEX_ROUTING_NODES — evaluated first; if it returns a result, routing
#      stops here and LLM routing is never attempted.
#   2. USE_LLM_ROUTING — attempted only when ONEX routing produced no result.
#   3. Fuzzy matching — always the final fallback.
# Enabling both flags is supported: ONEX takes precedence and LLM routing acts
# as a secondary enhancement layer before the fuzzy fallback.

# =============================================================================
# QUALITY ENFORCEMENT PHASES
# =============================================================================
# Configure the multi-phase quality enforcement pipeline.

# OPTIONAL: Enable Phase 1 - Fast Validation (<100ms)
# Default: true
ENABLE_PHASE_1_VALIDATION=true

# OPTIONAL: Enable Phase 2 - RAG Intelligence (<500ms)
# Default: true
ENABLE_PHASE_2_RAG=true

# OPTIONAL: Enable Phase 3 - Correction Generation
# Default: true
ENABLE_PHASE_3_CORRECTION=true

# OPTIONAL: Enable Phase 4 - AI Quorum Scoring (<1000ms)
# Default: false (computationally expensive)
ENABLE_PHASE_4_AI_QUORUM=false

# OPTIONAL: Total performance budget for quality enforcement (seconds)
# Default: 2.0
PERFORMANCE_BUDGET_SECONDS=2.0

# OPTIONAL: Enforcement mode for quality issues
# Values: advisory (warn only), blocking (reject), auto-fix (correct automatically)
# Default: advisory
ENFORCEMENT_MODE=advisory

# =============================================================================
# AGENT CONFIGURATION
# =============================================================================
# Settings for the agent registry and health monitoring.

# OPTIONAL: Path to agent registry directory
# Default: Auto-detected from plugin structure
# REGISTRY_PATH=/path/to/agents

# OPTIONAL: Health check server port (1-65535)
# Default: 8070
HEALTH_CHECK_PORT=8070

# =============================================================================
# EXTERNAL SERVICES (NOT IN PYTHON SETTINGS)
# =============================================================================
# These variables are used by shell scripts, Docker, or other components.
# They are NOT loaded by src/omniclaude/config/settings.py.

# OPTIONAL: General environment name for logging/debugging
# ENVIRONMENT=development

# OPTIONAL: Docker container name prefix
# CONTAINER_PREFIX=omniclaude

# OPTIONAL: Ollama base URL for local LLM inference
# OLLAMA_BASE_URL=http://localhost:11434

# OPTIONAL: Embedding service URL and dimensions
# EMBEDDING_SERVICE_URL=http://localhost:8002/v1/embeddings
# EMBEDDING_DIMENSIONS=768

# =============================================================================
# API KEYS (NOT IN PYTHON SETTINGS)
# =============================================================================
# API keys for external services. Used by shell scripts and other components.
# These are NOT loaded by src/omniclaude/config/settings.py.

# OPTIONAL: OpenAI API key (for GPT models)
# OPENAI_API_KEY=sk-...

# OPTIONAL: Google/Gemini API key
# GOOGLE_API_KEY=
# GEMINI_API_KEY=

# OPTIONAL: Anthropic API key (for Claude API)
# ANTHROPIC_API_KEY=sk-ant-...

# OPTIONAL: GitHub Personal Access Token (for gh CLI)
# GH_PAT=ghp_...

# =============================================================================
# SLACK NOTIFICATIONS
# =============================================================================
# Slack webhook for ticket workflow notifications (blocked/completed).
# Used by /ticket-work skill to notify when agent needs human input.

# OPTIONAL: Slack incoming webhook URL
# Get your webhook URL from: Slack App → Incoming Webhooks → Copy webhook URL
# When not set, Slack notifications are silently disabled
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/XXX/YYY/ZZZ

# =============================================================================
# DEBUGGING & TESTING (NOT IN PYTHON SETTINGS)
# =============================================================================
# Development and testing configuration.

# OPTIONAL: Enable debug mode
# DEBUG=false

# OPTIONAL: Logging level (DEBUG, INFO, WARNING, ERROR)
# LOG_LEVEL=INFO

# OPTIONAL: Enable Kafka integration tests (requires running Kafka)
# KAFKA_INTEGRATION_TESTS=1
