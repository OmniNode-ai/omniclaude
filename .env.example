# OmniClaude Environment Configuration
# ==============================================================================
# Copy this file to .env and fill in your actual API keys
# Never commit .env to version control!
#
# Setup Instructions:
# 1. cp .env.example .env
# 2. Edit .env with your actual API keys
# 3. source .env (or use direnv)
# 4. Verify: echo $GEMINI_API_KEY
#
# See SECURITY_KEY_ROTATION.md for detailed setup and rotation procedures
# ==============================================================================

# ------------------------------------------------------------------------------
# Google Gemini API Configuration
# ------------------------------------------------------------------------------
# Used by: Multi-provider support, AI quorum validation
# Get your key: https://console.cloud.google.com/apis/credentials
# Required for: Gemini Pro, Gemini Flash, Gemini 2.5 Flash providers
# Permissions: Enable "Generative Language API"
# Rate Limits: Check Google Cloud Console for your tier
GEMINI_API_KEY=your_gemini_api_key_here

# Google API Key (Pydantic AI Integration)
# Note: This should be the same as GEMINI_API_KEY for Pydantic AI compatibility
GOOGLE_API_KEY=your_gemini_api_key_here

# ------------------------------------------------------------------------------
# Z.ai API Configuration
# ------------------------------------------------------------------------------
# Used by: GLM model support, high-concurrency operations
# Get your key: https://z.ai/dashboard (or appropriate Z.ai portal)
# Required for: Z.ai provider (GLM-4.5-Air, GLM-4.5, GLM-4.6)
# Rate Limits:
#   - GLM-4.5-Air: 5 concurrent requests
#   - GLM-4.5: 20 concurrent requests
#   - GLM-4.6: 10 concurrent requests
ZAI_API_KEY=your_zai_api_key_here

# ------------------------------------------------------------------------------
# Hook Intelligence Database Configuration
# ------------------------------------------------------------------------------
# Used by: Claude Code hooks for event logging and intelligence gathering
# Purpose: Stores hook events, agent detections, tool usage, correlation tracking
# Database: PostgreSQL (omninode_bridge)
# Default for local development (matches agents/configs/env.example)
DB_PASSWORD=omninode-bridge-postgres-dev-2024

# ------------------------------------------------------------------------------
# Docker Compose Deployment Configuration
# ------------------------------------------------------------------------------
# Used by: deployment/docker-compose.yml for agent-observability-consumer service
# Purpose: Connects to external omninode-bridge PostgreSQL database
# Database: PostgreSQL (omninode_bridge)
# SECURITY WARNING: This is a development default - MUST be changed in production!
# Production deployment: Set via environment variable or secrets management
OMNINODE_BRIDGE_POSTGRES_PASSWORD=omninode-bridge-postgres-dev-2024

# ------------------------------------------------------------------------------
# Code Generation Database Configuration (OPTIONAL)
# ------------------------------------------------------------------------------
# Used by: Node generation pipeline for template cache metrics and session tracking
# Purpose: Persists generation sessions, artifacts, and template cache analytics
# Database: PostgreSQL (omninode_bridge)
#
# NOTE: This is OPTIONAL. If not set, the system will operate with:
# - In-memory template caching only (no database persistence)
# - Generation will work normally, but metrics won't be persisted
# - A single informational message will be logged at startup
#
# Required for:
# - Template cache metrics persistence
# - Generation session tracking
# - Code generation analytics
#
# Fallback behavior:
# - Template cache works normally (in-memory)
# - No repeated warnings (single info message on initialization)
# - All generation features remain functional
#
# To enable database persistence, uncomment and set:
# POSTGRES_PASSWORD=omninode-bridge-postgres-dev-2024
#
# Connection details (shared with hook intelligence):
# - Host: localhost (POSTGRES_HOST)
# - Port: 5436 (POSTGRES_PORT)
# - Database: omninode_bridge (POSTGRES_DB)
# - User: postgres (POSTGRES_USER)

# ------------------------------------------------------------------------------
# Kafka Configuration (Documentation Hooks)
# ------------------------------------------------------------------------------
# Used by: Git hooks for documentation change tracking
# Purpose: Publish documentation events for downstream processing
# Broker: Kafka bootstrap server address
# Topics:
#   - documentation-changed: Documentation file events (added, updated, deleted)
# Default for local development
KAFKA_BOOTSTRAP_SERVERS=localhost:9092
KAFKA_DOC_TOPIC=documentation-changed

# Optional: Enable/disable git hook validation
# Set to 'true' to validate documentation before push
GIT_HOOK_VALIDATE_DOCS=false

# ------------------------------------------------------------------------------
# Kafka Configuration (Event-Based Intelligence)
# ------------------------------------------------------------------------------
# Used by: IntelligenceEventClient (agents/lib/intelligence_event_client.py)
# Purpose: Event-driven pattern discovery from omniarchon intelligence service
# Integration: Replaces hard-coded filesystem paths with dynamic discovery
#
# Configuration:
KAFKA_INTELLIGENCE_BOOTSTRAP_SERVERS=localhost:29092
KAFKA_ENABLE_INTELLIGENCE=true
ENABLE_EVENT_BASED_DISCOVERY=true
ENABLE_FILESYSTEM_FALLBACK=true
PREFER_EVENT_PATTERNS=true
KAFKA_REQUEST_TIMEOUT_MS=5000

# Event Topics (ONEX architecture):
#   - dev.archon-intelligence.intelligence.code-analysis-requested.v1
#   - dev.archon-intelligence.intelligence.code-analysis-completed.v1
#   - dev.archon-intelligence.intelligence.code-analysis-failed.v1

# Port Mapping:
#   - External (host): localhost:29092 (use this in .env)
#   - Docker internal: omninode-bridge-redpanda:9092
#   - Redpanda Admin UI: http://localhost:8080

# Requirements:
#   - omniarchon intelligence service running (archon-intelligence on port 8053)
#   - Redpanda broker running (docker-compose up redpanda)
#   - Event topics created (auto-created on first publish)

# Feature Flags:
#   - KAFKA_ENABLE_INTELLIGENCE: Master switch for event-based intelligence
#   - ENABLE_EVENT_BASED_DISCOVERY: Enable event-first pattern discovery
#   - ENABLE_FILESYSTEM_FALLBACK: Fallback to filesystem on event failure
#   - PREFER_EVENT_PATTERNS: Prefer event patterns over built-in patterns

# Performance:
#   - Request timeout: 5000ms default (configurable)
#   - Target p95: <100ms response time
#   - Success rate: >95% (with fallback to filesystem)

# Troubleshooting:
#   - Verify Redpanda running: docker ps | grep redpanda
#   - Check topics: docker exec -it <redpanda-container> rpk topic list
#   - Test connectivity: poetry run python -c "from agents.lib.intelligence_event_client import IntelligenceEventClient; import asyncio; asyncio.run(IntelligenceEventClient().start())"
#   - See CLIENT_WORKS_EVIDENCE.md for validation evidence

# Related Documentation:
#   - EVENT_INTELLIGENCE_INTEGRATION_PLAN.md - Integration architecture
#   - CLIENT_WORKS_EVIDENCE.md - Functionality validation
#   - EVENT_INTELLIGENCE_DEVELOPER_GUIDE.md - Developer integration guide

# ------------------------------------------------------------------------------
# Development Repository Paths (OPTIONAL)
# ------------------------------------------------------------------------------
# Used by: Code refiner (agents/lib/code_refiner.py) for production pattern discovery
# Purpose: Enables code refinement with production ONEX patterns from sibling repositories
# Default: Automatically resolves to sibling directories (../omniarchon, ../omninode_bridge)
#
# Only set these if:
# - Repositories are not in standard sibling location
# - Using custom directory structure
# - Running in CI/CD with specific paths
#
# If not set, defaults to:
# - OMNIARCHON_PATH: ../omniarchon (relative to omniclaude)
# - OMNINODE_BRIDGE_PATH: ../omninode_bridge (relative to omniclaude)
#
# OMNIARCHON_PATH=/custom/path/to/omniarchon
# OMNINODE_BRIDGE_PATH=/custom/path/to/omninode_bridge

# ------------------------------------------------------------------------------
# Security Best Practices
# ------------------------------------------------------------------------------
# 1. Never commit .env files to version control
# 2. Rotate keys every 30-90 days (see SECURITY_KEY_ROTATION.md)
# 3. Use separate keys for development and production
# 4. Enable IP restrictions in provider dashboards
# 5. Set usage quotas to limit damage from leaks
# 6. Monitor API usage regularly
#
# See SECURITY_KEY_ROTATION.md for:
# - How to obtain API keys
# - Step-by-step rotation procedures
# - Testing new keys
# - Troubleshooting common issues
# ------------------------------------------------------------------------------
